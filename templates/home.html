{% extends "base.html" %}
{% from "macros.html" import translate with context %}

{% block content %}
<div class="panel">
  <h1 class="mb-4">🏠 {{ translate("Dashboard") }}</h1>

  <p>
    {{ translate("Welcome") }}, <strong>{{ nickname }}</strong>!
  </p>

  {% if nickname == "ADMIN" %}
    <h2>{{ translate("Overall stats") }}</h2>
    <p>
      {{ translate("Total users:") }} {{ totale_utenti }}<br>
      {{ translate("Average score:") }} {{ media_punti }}
    </p>
    
    <a href="{{ url_for('gestione_utenti') }}" class="btn btn-outline-success my-3">
      👥 {{ translate("User Management") }}
    </a>

    <h4>{{ translate("Recently rewarded (last 7 days)") }}</h4>
    <ul>
      {% for n in premiati_recenti %}
        <li>{{ n }}</li>
      {% endfor %}
    </ul>
  {% else %}
    <h2>{{ translate("Your progress") }}</h2>
    <p>
      {{ translate("Points collected:") }} <strong>{{ punti }}</strong><br>
      {% if punti_mancanti != 0 %}
         {{ translate("Points to prize:")}} <strong>{{ punti_mancanti }}</strong><br>
      {% endif %}

      {{ translate("Completion:") }} <strong>{{ percentuale }}%</strong>
    </p>
    {% if punti >= 120 %}
  <div class="alert alert-success text-center mt-4" role="alert">
    <h4 class="alert-heading">🎉 {{ translate("Congratulations!") }}</h4>
    <p>{{ translate("You’ve earned a prize for reaching 120 points!") }}</p>
    <img src="{{ url_for('static', filename='img/premio.png') }}" alt="Premio" class="bounce-one" style="width:150px;">
  </div>

  <!-- Script confetti corretto -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script>
    confetti({
      particleCount: 100,
      spread: 70,
      origin: { y: 0.6 }
    });
  </script>
{% endif %}

    {% if punti >= 120 %}
      <div class="alert alert-success text-center mt-4" role="alert">
      <h4 class="alert-heading">🎉 {{ translate("Congratulations!") }}</h4>
          <p>{{ translate("You’ve earned a prize for reaching 120 points!") }}</p>
          <img src="{{ url_for('static', filename='img/premio.png') }}" alt="Premio" class="bounce-one" style="width:150px;">
     </div>
     <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
          <script>
          confetti({
          particleCount: 100,
          spread: 70,
          origin: { y: 0.6 }
          });
         <audio id="successSound" src="{{ url_for('static', filename='sounds/success.mp3') }}" preload="auto"></audio>
         document.getElementById('successSound').play();
     </script>


    {% endif %}
    <a href="{{ url_for('Robiettivi') }}" class="btn btn-primary">
      {{ translate("View Goals") }}
    </a>

  {% endif %}

  <div class="mt-4">
    <a href="{{ url_for('logout') }}" class="btn btn-outline-danger">
      {{ translate("Logout") }}
    </a>
  </div>
</div>
{% endblock %}
